<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VR Room with Movement</title>
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
</head>
<body>
<a-scene>
  <!-- Camera rig with wasd-controls for movement -->
  <a-entity id="cameraRig" position="0 1 0" movement-controls>
    <a-entity
      id="camera"
      camera
      wasd-controls="acceleration: 10"
      look-controls>
    </a-entity>

    <!-- Left controller -->
    <a-entity
      id="leftHand"
      laser-controls="hand: left"
      oculus-touch-controls="hand: left">
    </a-entity>

    <!-- Right controller -->
    <a-entity
      id="rightHand"
      laser-controls="hand: right"
      oculus-touch-controls="hand: right">
    </a-entity>
  </a-entity>

  <!-- Room walls -->
  <a-box
    position="0 1.5 -5"
    width="12"
    height="3"
    depth="12"
    color="#2e2e2e"
    material="side: double;">
  </a-box>

  <!-- Whiteboard -->
  <a-plane
    id="whiteboard"
    position="0 2 -4"
    width="4"
    height="2.5"
    color="#ffffff"
    shadow="cast: true">
    <a-light
      type="spot"
      intensity="1.5"
      position="0 3 0"
      angle="60"
      target="#whiteboard"
      color="#fffae6">
    </a-light>
    <a-text
      value="Bienvenue dans la salle immersive !\nUtilisez les flèches ou le joystick pour vous déplacer."
      align="center"
      width="3.8"
      position="0 0 0.1"
      color="#000000">
    </a-text>
  </a-plane>

  <!-- Decorations -->
  <!-- A plant in the corner -->
  <a-cylinder position="-5 0.5 -6" radius="0.2" height="1" color="#8B4513"></a-cylinder>
  <a-cone position="-5 1.5 -6" radius-bottom="0.5" radius-top="0.1" height="1" color="#228B22"></a-cone>

  <!-- A table with a book -->
  <a-cylinder position="3 0.4 -3" radius="0.5" height="0.1" color="#6b4f4f"></a-cylinder>
  <a-box position="3 0.5 -3" width="0.4" height="0.1" depth="0.3" color="#FFD700"></a-box>

  <!-- A painting on the wall -->

  <!-- Lights -->
  <a-light type="ambient" intensity="0.5" color="#ffffff"></a-light>
  <a-light type="point" intensity="1" color="#ffffff" position="0 3 2" target="#whiteboard"></a-light>

  <!-- Sky -->
  <a-sky color="#87CEEB"></a-sky>

  <!-- Exit VR functionality -->
  <script>
    // Exit VR on controller button press
    AFRAME.registerComponent('exit-on-button', {
      init: function () {
        this.el.addEventListener('triggerdown', function () {
          // Exit VR experience
          if (document.exitFullscreen) {
            document.exitFullscreen();
          }
          if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          }
        });
      },
    });

    // Attach the component to the controllers
    document.querySelector('#leftHand').setAttribute('exit-on-button', '');
    document.querySelector('#rightHand').setAttribute('exit-on-button', '');

    // Fallback for keyboard
    document.addEventListener('keydown', function (event) {
      if (event.code === "KeyX") {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
        if (document.webkitExitFullscreen) {
          document.exitFullscreen();
        }
      }
    });
  </script>
</a-scene>
</body>
</html>
